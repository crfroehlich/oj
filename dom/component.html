<!DOCTYPE html><html lang="en"><head><title>dom/component</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="dom/component"><meta name="groc-project-path" content="src/coffee/dom/component.coffee"><meta name="groc-github-url" content="https://github.com/somecallmechief/oj"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/somecallmechief/oj/blob/master/src/coffee/dom/component.coffee">src/coffee/dom/component.coffee</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="component">component</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="p">(</span><span class="nf">(OJ) -&gt;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create an HTML Web Component through ThinDom
* <code>options</code> an object representing the standard options to be passed into the component
<em>* <code>rootNodeType</code>: the tag name of the root node to create, default = 'div'
*</em> <code>props</code>: an object representing the DOM attributes to append to the root node
<em>* <code>styles</code>: an object representing the CSS attributes to append to the root node
*</em> <code>events</code>: an object reprenting the named DOM events (and corresponding callback methods) to bind to the root node 
* <code>owner</code> the parent to which the component node will be appended
* <code>tagName</code> the name of of the component, which will always be prefixed with 'x-'</p></div></div><div class="code"><div class="wrapper">  <span class="nv">component = </span><span class="p">(</span><span class="nv">options = </span><span class="nx">OJ</span><span class="p">.</span><span class="nx">object</span><span class="p">(),</span> <span class="nx">owner</span><span class="p">,</span> <span class="nx">tagName</span><span class="p">)</span> <span class="nf">-&gt;</span>
  
    <span class="k">if</span> <span class="o">not</span> <span class="nx">tagName</span><span class="p">.</span><span class="nx">startsWith</span> <span class="s">&#39;x-&#39;</span> <span class="k">then</span> <span class="nv">tagName = </span><span class="s">&#39;x-&#39;</span> <span class="o">+</span> <span class="nx">tagName</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>web components are really just ordinary OJ (element)[element.html]'s with a special name.
Until HTML Web Components are fully supported (and OJ is refactored accordingly), the element will be treated as an unknown element.
In most cases, the default behavior of the browser is acceptable (see also (HTML Semantics)[http://diveintohtml5.info/semantics.html]), but
in some cases this is problematic (firstly, because these elements are always rendered inline).
In such conditions, the (controls)[controls.html] class and name space is better suited to classes which require complete control (e.g. (icon)[icon.html]).</p></div></div><div class="code"><div class="wrapper">    <span class="nv">widget = </span><span class="nx">OJ</span><span class="p">.</span><span class="nx">element</span> <span class="nx">tagName</span> <span class="c1">#, options.props, options.styles, options.events, options.text</span>
    <span class="nx">OJ</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">factory</span> <span class="nx">widget</span><span class="p">,</span> <span class="nx">owner</span>
    </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Since the behavior of styling is not well controlled/controllable on unknown elements, it is necessary to create a root node for the component.
In most cases, (div)[div.html] is perfectly acceptable, but this is configurable at the name space level or at runtime. </p></div></div><div class="code"><div class="wrapper">    <span class="nv">rootNodeType = </span><span class="nx">options</span><span class="p">.</span><span class="nx">rootNodeType</span> <span class="o">or</span> <span class="nx">OJ</span><span class="p">[</span><span class="s">&#39;DEFAULT_COMPONENT_ROOT_NODETYPE&#39;</span><span class="p">]</span> <span class="o">or</span> <span class="s">&#39;div&#39;</span>
    </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>ret</code> is the the instance of the rootNodeType, not the <code>widget</code> wrapped in this closure</p></div></div><div class="code"><div class="wrapper">    <span class="nv">ret = </span><span class="nx">widget</span><span class="p">.</span><span class="nx">make</span> <span class="nx">rootNodeType</span><span class="p">,</span> <span class="nx">options</span>
    </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>for convenience and debugging, persist the tagName</p></div></div><div class="code"><div class="wrapper">    <span class="nx">ret</span><span class="p">.</span><span class="nx">add</span> <span class="s">&#39;componentName&#39;</span><span class="p">,</span> <span class="nx">tagName</span>
    </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>remove</code> does, however, behave as expected by removing <code>widget</code></p></div></div><div class="code"><div class="wrapper">    <span class="nx">ret</span><span class="p">.</span><span class="nx">add</span> <span class="s">&#39;remove&#39;</span><span class="p">,</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">remove</span>
    <span class="nx">ret</span>
    
  <span class="nx">OJ</span><span class="p">.</span><span class="nx">register</span> <span class="s">&#39;component&#39;</span><span class="p">,</span> <span class="nx">component</span>

  <span class="k">return</span>
<span class="p">)</span> <span class="p">((</span><span class="k">if</span> <span class="k">typeof</span> <span class="nx">global</span> <span class="o">isnt</span> <span class="s">&#39;undefined&#39;</span> <span class="o">and</span> <span class="nx">global</span> <span class="k">then</span> <span class="nx">global</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">isnt</span> <span class="s">&#39;undefined&#39;</span> <span class="k">then</span> <span class="nb">window</span> <span class="k">else</span> <span class="k">this</span><span class="p">)))).</span><span class="nx">OJ</span></div></div></div></div></body></html>